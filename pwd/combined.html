<html>
<head>
    <title>HuntingStats378 - MB Combined Subs</title>
    <link href="https://huntingstats378.github.io/HuntingStats378/main/assets/ess/odometer.css" rel="stylesheet">
    <link rel="icon" href="https://huntingstats378.github.io/HuntingStats378/main/images/logo.png">
    <meta charSet="utf-8" />
    <meta name="description" content="HuntingStats378 - Subscribers" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
</head>

<body style="font-family: Roboto; color: var(--fg-color, #fff); background-color: var(--bg-color, #E7541E);">
    <div style="height: auto; display: grid; grid-template-columns: repeat(1, 1fr); gap: 10px;">
        <div style="padding: 0px 4px; text-align: center; background-color: var(--counter-bg-color, black);">
            <img style="filter: blur(4px); border-radius: 15px; object-fit: cover; width: 100%; height: 150px; position: relative;" src="https://www.banner.yt/UCX6OQ3DkcsbYNE6H8uQQuVA">
            <img style="width: 125px; height: 125px; border-radius: 50%; margin-top: -5em; position: relative;" src="https://yt3.ggpht.com/fxGKYucJAVme-Yz4fsdCroCFCrANWqw0ql4GYuvx8Uq4l_euNJHgE-w9MTkLQA805vWCi-kE0g=s176-c-k-c0x00ffffff-no-rj">
            <h2 style="margin-top: 1px; font-size: var(--title-font-size, 4.5vh)">MrBeast Combined</h2>
            <h2 id="subs" style="margin-top: -20px; font-size: var(--counter-font-size, 8vh)" class="odometer">0</h2>
            <h5 onclick="footer()" style="margin-top: -40px;">Subscribers (Estimated)</h5>
        </div>
    </div>
    <div id="chart" class="chart" style="background-color: black;"></div>
</body>
<script src="https://huntingstats378.github.io/HuntingStats378/main/assets/ess/odometer.js"></script>
<script src="https://huntingstats378.github.io/HuntingStats378/main/assets/ess/highstock.js"></script>
<script>
  let Channels = [];
  let work = [];
  const maxPoints = 3600;

  // Load channel IDs from combined.json
  fetch('./combined.json')
    .then((res) => res.json())
    .then((data) => {
      Channels = data.Channels;
      render(); // Start rendering once Channels is loaded
      setInterval(render, 2000); // Update periodically
    })
    .catch((error) => console.error('Error loading channels:', error));

  async function render() {
    try {
      await datas();
      const totalSubscribers = work.reduce((a, b) => a + b, 0);
      document.getElementById('subs').innerHTML = totalSubscribers;

      if (chart.series[0].points.length === maxPoints) {
        chart.series[0].data[0].remove();
      }
      chart.series[0].addPoint([Date.now(), totalSubscribers]);
    } catch (error) {
      console.error('Error rendering data:', error);
    }
  }

  async function datas() {
    for (let i = 0; i < Channels.length; i++) {
      try {
        const response = await fetch(`https://axern.space/api/get?platform=youtube&type=channel&id=${Channels[i]}`);
        const data = await response.json();
        work[i] = data.apiSubCount || 0; // Handle cases where apiSubCount is missing
      } catch (error) {
        console.error(`Error fetching data for channel ${Channels[i]}:`, error);
        work[i] = 0; // Default to 0 on error
      }
    }
  }

  // Highcharts configuration
  const textBright = "#bdbdbd";
  const lineColor = "#000000";
  const chart = new Highcharts.chart({
    chart: {
      renderTo: 'chart',
      type: 'line',
      zoomType: 'x',
      backgroundColor: 'transparent',
      plotBorderColor: 'transparent'
    },
    title: {
      text: ' '
    },
    xAxis: {
      type: 'datetime',
      tickPixelInterval: 500,
      gridLineColor: textBright,
      labels: {
        style: {
          color: textBright
        }
      },
      lineColor: lineColor,
      minorGridLineColor: '#bdbdbd',
      tickColor: lineColor,
      title: {
        style: {
          color: textBright
        }
      }
    },
    yAxis: {
      title: {
        text: ''
      },
      gridLineColor: textBright,
      labels: {
        style: {
          color: textBright
        }
      },
      lineColor: lineColor,
      minorGridLineColor: '#bdbdbd',
      tickColor: lineColor
    },
    credits: {
      enabled: false
    },
    series: [{
      showInLegend: false,
      name: 'Subscribers',
      marker: {
        enabled: false
      },
      color: '#000000',
      lineColor: '#FFFFFF'
    }]
  });

  function footer() {
    window.location.href = "./../";
  }
</script>
